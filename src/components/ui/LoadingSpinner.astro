---
interface Props {
  size?: 'sm' | 'md' | 'lg';
  color?: string;
  text?: string;
  showProgress?: boolean;
}

const { 
  size = 'md',
  color = 'primary',
  text = '加载中...',
  showProgress = false
} = Astro.props;

const sizeClasses = {
  sm: 'h-6 w-6',
  md: 'h-12 w-12',
  lg: 'h-16 w-16'
};
---

<div id="loading" class="absolute inset-0 flex flex-col items-center justify-center bg-background-light bg-opacity-75 backdrop-blur-sm transition-opacity duration-300 z-10">
  <div class={`animate-spin rounded-full border-t-2 border-b-2 border-${color} ${sizeClasses[size]} mb-4`}>
    <span class="sr-only" role="status" aria-live="polite">{text}</span>
  </div>
  
  <div class="text-text text-center">
    <p class="mb-2">{text}</p>
    {showProgress && (
      <div class="w-48 h-2 bg-background-light rounded-full overflow-hidden">
        <div id="progress-bar" class="h-full bg-primary transition-all duration-300" style="width: 0%"></div>
      </div>
    )}
  </div>
</div>

<style>
  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
  
  .animate-spin {
    animation: spin 1s linear infinite;
  }
</style>

<script>
  // 简单的加载进度模拟
  const loading = document.getElementById('loading');
  const progressBar = document.getElementById('progress-bar');
  
  if (loading && progressBar) {
    let progress = 0;
    const interval = setInterval(() => {
      progress += 5;
      if (progress >= 90) {
        clearInterval(interval);
      }
      progressBar.style.width = `${progress}%`;
    }, 200);

    // 监听 iframe 加载完成
    const iframe = document.getElementById('fiddlebops-iframe');
    if (iframe) {
      iframe.addEventListener('load', () => {
        progress = 100;
        progressBar.style.width = '100%';
        setTimeout(() => {
          loading.style.opacity = '0';
          loading.style.pointerEvents = 'none';
        }, 300);
      });
    }
  }
</script> 