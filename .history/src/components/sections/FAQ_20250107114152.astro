---
interface FAQ {
  question: string;
  answer: string;
}

const faqs: FAQ[] = [
  {
    question: "什么是 FiddleBops？",
    answer:
      "FiddleBops 是一款富有创意的音乐制作游戏，玩家可以通过混合独特的角色声音来创作原创作品。",
  },
  {
    question: "我需要下载任何东西才能玩吗？",
    answer: "不需要，FiddleBops 直接在您的 Web 浏览器中运行，无需下载或安装。",
  },
  {
    question: "如何开始创作音乐？",
    answer:
      "只需将角色拖到舞台上，即可将他们的声音添加到您的组合中。尝试不同的组合以获得独特的曲目。",
  },
  {
    question: "我可以保存我的作品吗？",
    answer: "是的，玩家可以保存他们的作品并在社区中与他人分享。",
  },
  {
    question: "FiddleBops 可以免费玩吗？",
    answer: "是的，这款游戏在 Sprunki InCrediBox 平台上完全免费。",
  },
];

// 生成结构化数据
const structuredData = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  mainEntity: faqs.map((faq) => ({
    "@type": "Question",
    name: faq.question,
    acceptedAnswer: {
      "@type": "Answer",
      text: faq.answer,
    },
  })),
};
---

<section
  id="faq"
  class="mb-16 scroll-mt-20"
  aria-labelledby="faq-title"
>
  <h2
    id="faq-title"
    class="text-3xl font-bold font-display text-accent mb-8 text-center"
  >
    常见问题
  </h2>

  <div class="container mx-auto px-4">
    <div class="max-w-3xl mx-auto space-y-4">
      {
        faqs.map((faq, index) => (
          <div
            class="bg-card hover:bg-card-hover backdrop-blur-sm rounded-lg transition-all duration-300"
          >
            <button
              class="w-full p-6 flex justify-between items-center gap-4 text-left"
              aria-expanded="false"
              aria-controls={`faq-answer-${index}`}
              data-faq-trigger
            >
              <span class="font-bold text-xl text-secondary">
                {faq.question}
              </span>
              <svg
                class="w-6 h-6 flex-shrink-0 transition-transform duration-300"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            </button>

            <div
              id={`faq-answer-${index}`}
              class="hidden p-6 pt-0 text-text"
            >
              <div>
                <p>{faq.answer}</p>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<!-- 注入结构化数据 -->
<script type="application/ld+json" set:html={JSON.stringify(structuredData)} />

<script>
  // 处理 FAQ 交互
  document.addEventListener("DOMContentLoaded", () => {
    const faqTriggers =
      document.querySelectorAll<HTMLButtonElement>("[data-faq-trigger]");

    faqTriggers.forEach((trigger: HTMLButtonElement) => {
      trigger.addEventListener("click", () => {
        const isExpanded = trigger.getAttribute("aria-expanded") === "true";
        const answerId = trigger.getAttribute("aria-controls")!;
        const answer = document.getElementById(answerId);
        const icon = trigger.querySelector("svg");

        // 更新状态
        trigger.setAttribute("aria-expanded", (!isExpanded).toString());
        answer?.classList.toggle("hidden");
        icon?.classList.toggle("rotate-180");
      });

      // 添加键盘支持
      trigger.addEventListener("keydown", (e: Event) => {
        const keyEvent = e as KeyboardEvent;
        if (keyEvent.key === "Enter" || keyEvent.key === " ") {
          e.preventDefault();
          trigger.click();
        }
      });
    });
  });
</script>
